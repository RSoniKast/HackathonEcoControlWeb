<?php 
session_start();
$bdd = new PDO('mysql:host=localhost;dbname=mesure', 'root', '');

if(isset($_SESSION['username'])) {
    // Récupérer les informations de l'utilisateur
    $query = $bdd->prepare("SELECT pseudo, photo_profil FROM users WHERE pseudo = ?");
    $query->execute([$_SESSION['username']]);
    $user = $query->fetch(PDO::FETCH_ASSOC);
    
}

// Afficher le message d'erreur s'il existe
$error_message = "";
if(isset($_SESSION['error'])) {
    $error_message = $_SESSION['error'];
    unset($_SESSION['error']);
}

// Vérifier si l'utilisateur a cliqué sur le lien de déconnexion
if (isset($_GET['logout'])) {
    // Terminer la session
    session_unset();
    session_destroy();
    // Rediriger vers la page de connexion
    header("Location: login.php");
    exit();
}

?>
<!doctype html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>EcoControl - Conditions générales d'utilisation</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    </head>

  <nav class="navbar fixed-top navbar-light bg-light">
    <div class="container">
        <a href="index" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
          <span class="fs-4">
              <bold><span class="text-primary">Eco</span><span class="text-success">Control</bold></span>
          </span>
        </a>
        <ul class="nav nav-pills">
          <li class="nav-item"><a href="index" class="nav-link text-success" aria-current="page">Accueil</a></li>
          <li class="nav-item"><a href="#" class="nav-link text-success">À Propos</a></li>
          <li class="nav-item"><a href="contact" class="nav-link text-success">Contact</a></li>
          <?php
          if (isset($_SESSION['username']))   {
              // Afficher le lien vers la page de profil avec le pseudo de l'utilisateur
              $username = htmlspecialchars($_SESSION['username'], ENT_QUOTES, 'UTF-8');
              echo "<li class='nav-item'><a href='user.php' class='nav-link text-success'>{$username}</a></li>";
              echo "<li class='nav-item'><a class='btn btn-success' href='user.php?logout=true'>Déconnexion</a></li>";
          } else {
              echo "<li><a href='login.php' class='btn btn-outline-success me-2' style='text-decoration:none'>Connexion</a></li>";
              echo "<li><a href='register.php' class='btn btn-success'>S'inscrire</a></li>";
          }
          ?>
        </ul>
    </div>
  </nav>

    <div class="px-4 py-5 my-5 mx-5 text-justify">
        <h1 class="display-4 text-center">Politique de Confidentialité pour EcoControl</h1>
            Chez EcoControl, nous respectons votre vie privée et nous nous engageons à protéger vos données personnelles. Cette politique de confidentialité explique quelles informations nous collectons, comment nous les utilisons, et les mesures que nous prenons pour les protéger.
            <h3>Données Collectées</h3>
            Nous collectons les types de données suivants :
            <br>
            Informations de consommation énergétique :
            <li>Tension</li>
            <li>Horaire</li>
            <li>Temperature</li>
            <li>Humidité</li>

            Informations personnelles de base :
            <li>Pseudo.</li>
            <li>Adresse email.</li>
            <li>Mot de passe</li>
            <li>Date de naissance</li>
            <li>Identifiant</li>
            <li>Photo de profil</li>

            <h3>Utilisation des Données</h3>
            Les données collectées sont utilisées pour :
            <li>Optimiser votre consommation énergétique.</li>
            <li>Fournir des rapports et des recommandations personnalisés.</li>
            <li>Sensibiliser à la réduction de la consommation énergétique.</li>

            <h3>Base Légale du Traitement</h3>
            Nous traitons vos données personnelles sur la base des fondements légaux suivants :
            <li>Consentement : Lorsque vous nous donnez votre consentement explicite pour traiter vos données.</li>
            <li>Exécution d'un contrat : Lorsque le traitement de vos données est nécessaire pour l'exécution d'un contrat auquel vous êtes partie.</li>
            <li>Intérêt légitime : Lorsque le traitement est nécessaire à nos intérêts légitimes et ne porte pas atteinte à vos droits.</li>
            <h3>Partage des Données</h3>

            Nous ne partageons vos données personnelles avec aucun tiers, sauf dans les cas suivants :
            <li>Si requis par la loi.</li>
            <li>Avec votre consentement explicite.</li>

            <h3>Durée de Conservation des Données</h3>
            Nous conservons vos données personnelles uniquement le temps nécessaire pour les finalités pour lesquelles elles ont été collectées, sauf si une période de conservation plus longue est requise ou autorisée par la loi.

            <h3>Traitement des Données par des Tiers</h3>
            Vos données peuvent être traitées par des fournisseurs de services tiers qui nous aident à fournir nos services. Nous nous assurons que ces tiers respectent des normes de protection des données équivalentes aux nôtres.

            <h3>Vos Droits</h3>
            Conformément à la réglementation RGPD, vous disposez des droits suivants :
            <li>Droit d'accès : Vous pouvez demander à consulter les données personnelles que nous détenons à votre sujet.</li>
            <li>Droit de rectification : Vous pouvez demander la correction des données inexactes ou incomplètes.</li>
            <li>Droit à l'effacement : Vous pouvez demander la suppression de vos données personnelles.</li>
            <li>Droit d'opposition : Vous pouvez vous opposer au traitement de vos données personnelles.</li>
            <li>Droit à la portabilité : Vous pouvez demander à recevoir vos données personnelles dans un format structuré, couramment utilisé et lisible par machine.</li>
            Pour exercer ces droits, veuillez nous contacter à : contact@ecocontrol.fr.

            <h3>Sécurité des Données</h3>
            Nous mettons en œuvre des mesures de sécurité appropriées pour protéger vos données personnelles contre l'accès non autorisé, la divulgation, la modification ou la destruction. Ces mesures incluent :
            <li>Chiffrement des données.</li>
            <li>Authentification des utilisateurs.</li>

            <h3>Cookies et Technologies Similaires</h3>
            Nous utilisons des cookies et des technologies similaires pour améliorer votre expérience sur notre site. Vous pouvez gérer vos préférences de cookies via les paramètres de votre navigateur.

            <h3>Modifications de la Politique de Confidentialité</h3>
            Nous pouvons mettre à jour cette politique de confidentialité de temps en temps. Toute modification sera publiée sur cette page, et si les changements sont significatifs, nous vous en informerons par email.

            <h3>Contact</h3>
            Pour toute question ou demande concernant vos données personnelles ou cette politique de confidentialité, veuillez nous contacter à : contact@ecocontrol.fr.
    </div>

    <footer class="container py-5">
        <div class="row">
            <div class="col-12 col-md">
            EcoControl © 2024
            </div>
            <div class="col-6 col-md">
            <h5>Pages</h5>
            <ul class="list-unstyled text-small">
                <li><a class="link-secondary text-decoration-none" href="index">Accueil</a></li>
                <li><a class="link-secondary text-decoration-none" href="questions">F.A.Q.</a></li>
            </ul>
            </div>
            <div class="col-6 col-md">
            <h5>Autres</h5>
            <ul class="list-unstyled text-small">
                <li><a class="link-secondary text-decoration-none" href="about">À Propos</a></li>
                <li><a class="link-secondary text-decoration-none" href="contact">Contactez-nous</a></li>
                <li><a class="link-secondary text-decoration-none" href="terms">Conditions générales d'utilisation</a></li>
            </ul>
            </div>
        </div>
    </footer>
</html>